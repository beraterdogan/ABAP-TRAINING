
*****************ANA EKRAN******************

*&---------------------------------------------------------------------*
*& Report ZBE_P_004
*&---------------------------------------------------------------------*
*&
*&---------------------------------------------------------------------*
REPORT ZBE_P_004.
INCLUDE ZBE_I_004_TOP.
INCLUDE ZBE_I_004_FORM.


INITIALIZATION.
  P_OGR = ABAP_TRUE.


AT SELECTION-SCREEN OUTPUT.

  CONSTANTS: C_RANGE_NO     TYPE INRI-NRRANGENR VALUE '01',
             C_RANGE_OBJECT TYPE INRI-OBJECT VALUE 'ZBE_NRO_T'.

  CALL FUNCTION 'NUMBER_GET_NEXT'
    EXPORTING
      NR_RANGE_NR = C_RANGE_NO
      OBJECT      = C_RANGE_OBJECT
    IMPORTING
      NUMBER      = P_OGRNO1.

  CONSTANTS: C1_RANGE_NO     TYPE INRI-NRRANGENR VALUE '01',
             C1_RANGE_OBJECT TYPE INRI-OBJECT VALUE 'ZBE_NRO_T'.

  CALL FUNCTION 'NUMBER_GET_NEXT'
    EXPORTING
      NR_RANGE_NR = C1_RANGE_NO
      OBJECT      = C1_RANGE_OBJECT
    IMPORTING
      NUMBER      = P_ISLMNO.

  CONSTANTS: C2_RANGE_NO     TYPE INRI-NRRANGENR VALUE '01',
             C2_RANGE_OBJECT TYPE INRI-OBJECT VALUE 'ZBE_NRO_T'.

  CALL FUNCTION 'NUMBER_GET_NEXT'
    EXPORTING
      NR_RANGE_NR = C2_RANGE_NO
      OBJECT      = C2_RANGE_OBJECT
    IMPORTING
      NUMBER      = P_KTPNO1.

  CONSTANTS: C3_RANGE_NO     TYPE INRI-NRRANGENR VALUE '01',
             C3_RANGE_OBJECT TYPE INRI-OBJECT VALUE 'ZBE_NRO_T'.

  CALL FUNCTION 'NUMBER_GET_NEXT'
    EXPORTING
      NR_RANGE_NR = C3_RANGE_NO
      OBJECT      = C3_RANGE_OBJECT
    IMPORTING
      NUMBER      = P_YZRNO1.



  LOOP AT SCREEN.

    IF P_OGR = ABAP_FALSE.
      CLEAR: P_OGRAD, P_OGRSOY, P_CINS, P_DTARIH, P_SINIF, P_PUAN.
    ENDIF.

    IF P_ISLEM = ABAP_FALSE.
      CLEAR: P_OGRNO, P_KTPNO, P_ATARIH, P_VTARIH.
    ENDIF.
    IF P_KITAP = ABAP_FALSE.
      CLEAR: P_ISBNO, P_KTPAD, P_YZRNO, P_TURNO, P_SYFSYS, P_KTPPN.
    ENDIF.

    IF P_YAZAR = ABAP_FALSE.
      CLEAR: P_YZRAD, P_YZRSOY.
    ENDIF.


  ENDLOOP.

  LOOP AT SCREEN.

    IF P_OGR = ABAP_TRUE.
      IF SCREEN-GROUP1 = 'OGR' OR SCREEN-GROUP1 ='OG'.
        SCREEN-ACTIVE = 1.
        MODIFY SCREEN.
      ENDIF.
    ENDIF.

    IF P_OGR = ABAP_FALSE.
      IF SCREEN-GROUP1 = 'OGR' OR SCREEN-GROUP1 = 'OG'.
        SCREEN-ACTIVE = 0.
        MODIFY SCREEN.
      ENDIF.
    ENDIF.

    IF P_ISLEM = ABAP_TRUE.
      IF SCREEN-GROUP1 = 'ISL' OR SCREEN-GROUP1 = 'IS'.
        SCREEN-ACTIVE = 1.
        MODIFY SCREEN.
      ENDIF.
    ENDIF.

    IF P_ISLEM = ABAP_FALSE.
      IF SCREEN-GROUP1 = 'ISL' OR SCREEN-GROUP1 = 'IS'.
        SCREEN-ACTIVE = 0.
        MODIFY SCREEN.
      ENDIF.
    ENDIF.

    IF P_KITAP = ABAP_TRUE.
      IF SCREEN-GROUP1 = 'KTP' OR SCREEN-GROUP1 = 'KT'.
        SCREEN-ACTIVE = 1.
        MODIFY SCREEN.
      ENDIF.
    ENDIF.

    IF P_KITAP = ABAP_FALSE.
      IF SCREEN-GROUP1 = 'KTP' OR SCREEN-GROUP1 = 'KT'.
        SCREEN-ACTIVE = 0.
        MODIFY SCREEN.
      ENDIF.
    ENDIF.

    IF P_YAZAR = ABAP_TRUE.
      IF SCREEN-GROUP1 = 'YZR' OR SCREEN-GROUP1 = 'YZ'.
        SCREEN-ACTIVE = 1.
        MODIFY SCREEN.
      ENDIF.
    ENDIF.

    IF P_YAZAR = ABAP_FALSE.
      IF SCREEN-GROUP1 = 'YZR' OR SCREEN-GROUP1 = 'YZ'.
        SCREEN-ACTIVE = 0.
        MODIFY SCREEN.
      ENDIF.
    ENDIF.

  ENDLOOP.

  LOOP AT SCREEN.
    IF P_OGR = ABAP_TRUE.
      IF SCREEN-GROUP1 = 'OG'.
        SCREEN-INPUT = 0.
        MODIFY SCREEN.
      ENDIF.
    ENDIF.

    IF P_ISLEM = ABAP_TRUE.
      IF SCREEN-GROUP1 = 'IS'.
        SCREEN-INPUT = 0.
        MODIFY SCREEN.
      ENDIF.
    ENDIF.

    IF P_KITAP = ABAP_TRUE.
      IF SCREEN-GROUP1 = 'KT'.
        SCREEN-INPUT = 0.
        MODIFY SCREEN.
      ENDIF.
    ENDIF.

    IF P_YAZAR = ABAP_TRUE.
      IF SCREEN-GROUP1 = 'YZ'.
        SCREEN-INPUT = 0.
        MODIFY SCREEN.
      ENDIF.
    ENDIF.

  ENDLOOP.


START-OF-SELECTION.


  IF P_OGR = ABAP_TRUE.

    IF P_OGRAD IS INITIAL OR P_OGRSOY IS INITIAL OR P_CINS IS INITIAL OR P_DTARIH IS INITIAL OR P_SINIF IS INITIAL OR P_PUAN IS INITIAL.
      MESSAGE 'Öğrencinin kayıt edilebilmesi için tüm alanların doldurulması gerekmektedir.' TYPE 'W'. RETURN.
    ELSEIF P_PUAN < 0 OR P_PUAN > 100 .
      MESSAGE: 'Öğrenci puanı 0 ile 100 arasında olmalıdır.' TYPE 'W'. RETURN.
    ENDIF.

  ENDIF.

  IF P_ISLEM = ABAP_TRUE.

    IF P_OGRNO IS INITIAL OR P_KTPNO IS INITIAL OR P_ATARIH IS INITIAL OR P_VTARIH IS INITIAL.
      MESSAGE 'Kitap kiralama işleminin yapılabilmesi için tüm alanların doldurulması gerekmektedir. ' TYPE 'W'. RETURN.
    ELSEIF P_VTARIH < P_ATARIH.
      MESSAGE 'Yanlış veri girdiniz. Kitap alınan tarih, kitabın iade edileceği tarihten önce olmalıdır.. ' TYPE 'W'. RETURN.
    ENDIF.

  ENDIF.

  IF P_KITAP = ABAP_TRUE.

    IF P_KTPAD IS INITIAL OR P_YZRNO IS INITIAL OR P_SYFSYS IS INITIAL OR P_KTPPN IS INITIAL.
      MESSAGE 'Yeni kitap eklenebilmesi için kitap numarası, kitap adı, yazar numarası, sayfa sayısı kitap puanı alanlarınım boş bırakılmaması gerekmektedir.' TYPE 'W'. RETURN.
    ELSEIF P_KTPPN < 0 OR P_KTPPN > 100 .
      MESSAGE: 'Kitap puanı 0 ile 100 arasında bir sayı olmalıdır.' TYPE 'W'. RETURN.
    ENDIF.

  ENDIF.

  IF P_YAZAR = ABAP_TRUE.

    IF P_YZRAD IS INITIAL.
      MESSAGE 'Yeni yazar bilgisi eklenebilmesi için yazar numarası ve yazar adı alanlarının doldurulması gerekmektedir.' TYPE 'W'. RETURN.
    ENDIF..

  ENDIF.

  IF P_OGR EQ ABAP_TRUE.
    PERFORM OGRKYT.
  ENDIF.
  IF P_ISLEM EQ ABAP_TRUE.
    PERFORM KIRALAMA.
  ENDIF.
  IF P_KITAP EQ ABAP_TRUE.
    PERFORM KTPKYT.
  ENDIF.
  IF P_YAZAR EQ ABAP_TRUE.
    PERFORM YZRKYT.
  ENDIF.


************************TOP******************************


*&---------------------------------------------------------------------*
*& Include          ZBE_I_004_TOP
*&---------------------------------------------------------------------*

TABLES: ZBE_T_OGRENCI, ZBE_T_ISLEM, ZBE_T_KITAP, ZBE_T_YAZAR, ZBE_T_TUR1.

SELECTION-SCREEN BEGIN OF BLOCK RAD1 WITH FRAME TITLE TEXT-001.
PARAMETERS     P_OGR         RADIOBUTTON GROUP GR1 USER-COMMAND CB1.
PARAMETERS     P_ISLEM       RADIOBUTTON GROUP GR1.
PARAMETERS     P_KITAP       RADIOBUTTON GROUP GR1.
PARAMETERS     P_YAZAR       RADIOBUTTON GROUP GR1.
SELECTION-SCREEN END OF BLOCK RAD1.

SELECTION-SCREEN BEGIN OF BLOCK RAD2 WITH FRAME TITLE TEXT-002.
PARAMETERS     P_OGRNO1      TYPE ZBE_DE_OGRNO       MODIF ID OG.
PARAMETERS     P_OGRAD       TYPE ZBE_DE_OGRAD       MODIF ID OGR.
PARAMETERS     P_OGRSOY      TYPE ZBE_DE_OGRSOYAD    MODIF ID OGR.
PARAMETERS     P_CINS        TYPE ZBE_DE_CINSIYET    MODIF ID OGR.
PARAMETERS     P_DTARIH      TYPE ZBE_DE_DTARIH      MODIF ID OGR.
PARAMETERS     P_SINIF       TYPE ZBE_DE_SINIF       MODIF ID OGR.
PARAMETERS     P_PUAN        TYPE ZBE_DE_PUAN        MODIF ID OGR.
SELECTION-SCREEN END OF BLOCK RAD2.

SELECTION-SCREEN BEGIN OF BLOCK RAD3 WITH FRAME TITLE TEXT-003.
PARAMETERS     P_ISLMNO      TYPE ZBE_DE_ISLEMNO     MODIF ID IS.
PARAMETERS     P_OGRNO       TYPE ZBE_DE_OGRNO       MODIF ID ISL MATCHCODE OBJECT ZBE_SH_OGRENCI.
PARAMETERS     P_KTPNO       TYPE ZBE_DE_KITAPNO     MODIF ID ISL MATCHCODE OBJECT ZBE_SH_KITAP.
PARAMETERS     P_ATARIH      TYPE ZBE_DE_ATARIH      MODIF ID ISL.
PARAMETERS     P_VTARIH      TYPE ZBE_DE_VTARIH      MODIF ID ISL.
SELECTION-SCREEN END OF BLOCK RAD3.
SELECTION-SCREEN BEGIN OF BLOCK RAD4 WITH FRAME TITLE TEXT-004.
PARAMETERS     P_KTPNO1      TYPE ZBE_DE_KITAPNO     MODIF ID KT.
PARAMETERS     P_ISBNO       TYPE ZBE_DE_ISBNO       MODIF ID KTP.
PARAMETERS     P_KTPAD       TYPE ZBE_DE_KITAPAD     MODIF ID KTP.
PARAMETERS     P_YZRNO       TYPE ZBE_DE_YAZARNO     MODIF ID KTP MATCHCODE OBJECT ZBE_SH_YAZAR.
PARAMETERS     P_TURNO       TYPE ZBE_DE_TURNO       MODIF ID KTP MATCHCODE OBJECT ZBE_SH_TUR1.
PARAMETERS     P_SYFSYS      TYPE ZBE_DE_SAYFASAYISI MODIF ID KTP.
PARAMETERS     P_KTPPN       TYPE ZBE_DE_KITAPPUAN   MODIF ID KTP.
SELECTION-SCREEN END OF BLOCK RAD4.
SELECTION-SCREEN BEGIN OF BLOCK RAD5 WITH FRAME TITLE TEXT-005.
PARAMETERS     P_YZRNO1      TYPE ZBE_DE_YAZARNO     MODIF ID YZ.
PARAMETERS     P_YZRAD       TYPE ZBE_DE_YAZARAD     MODIF ID YZR.
PARAMETERS     P_YZRSOY      TYPE ZBE_DE_YAZARSOYAD  MODIF ID YZR.
SELECTION-SCREEN END OF BLOCK RAD5.

***************************FORM**********************

*&---------------------------------------------------------------------*
*& Include          ZBE_I_004_FORM
*&---------------------------------------------------------------------*

*&---------------------------------------------------------------------*
*& Include          ZBE_I_004_FORM
*&---------------------------------------------------------------------*

FORM OGRKYT .

  ZBE_T_OGRENCI-OGRNO    = P_OGRNO1.
  ZBE_T_OGRENCI-OGRAD    = P_OGRAD.
  ZBE_T_OGRENCI-OGRSOYAD = P_OGRSOY.
  ZBE_T_OGRENCI-CINSIYET = P_CINS.
  ZBE_T_OGRENCI-DTARIH   = P_DTARIH.
  ZBE_T_OGRENCI-SINIF    = P_SINIF.
  ZBE_T_OGRENCI-PUAN     = P_PUAN.

  MODIFY ZBE_T_OGRENCI.
  IF SY-SUBRC = 0.
    MESSAGE 'Öğrenci kaydı başarıyla oluşturuldu.' TYPE 'S' .
  ENDIF.
ENDFORM.

FORM KIRALAMA .

  SELECT SINGLE PUAN FROM ZBE_T_OGRENCI INTO ZBE_T_OGRENCI-PUAN WHERE OGRNO = P_OGRNO.
  SELECT SINGLE VTARIH FROM ZBE_T_ISLEM INTO ZBE_T_ISLEM-VTARIH WHERE OGRNO = P_OGRNO.

  IF ZBE_T_OGRENCI-PUAN < 40 AND ZBE_T_ISLEM-VTARIH > SY-DATUM.
    MESSAGE 'Öğrenci yalnızca bir kitap alabilir' TYPE 'I'. RETURN.
  ELSEIF ZBE_T_OGRENCI-PUAN > 40.
    MESSAGE 'Öğrenci birden fazla kitap alabilir.' TYPE 'I'.
  ENDIF.

  ZBE_T_ISLEM-ISLEMNO = P_ISLMNO.
  ZBE_T_ISLEM-OGRNO = P_OGRNO.
  ZBE_T_ISLEM-KITAPNO = P_KTPNO.
  ZBE_T_ISLEM-ATARIH = P_ATARIH.
  ZBE_T_ISLEM-VTARIH = P_VTARIH.

  MODIFY ZBE_T_ISLEM.


  IF SY-SUBRC = 0.
    MESSAGE 'Kiralama işlem kaydı başarıyla oluşturuldu.' TYPE 'S' .
  ENDIF.
ENDFORM.

FORM KTPKYT .

  ZBE_T_KITAP-KITAPNO = P_KTPNO1.
  ZBE_T_KITAP-ISBNO = P_ISBNO.
  ZBE_T_KITAP-KITAPAD = P_KTPAD.
  ZBE_T_KITAP-YAZARNO = P_YZRNO.
  ZBE_T_KITAP-SAYFASAYISI = P_SYFSYS.
  ZBE_T_KITAP-KITAPPUAN = P_KTPPN.
  ZBE_T_KITAP-TURNO = P_TURNO.

  MODIFY ZBE_T_KITAP.

  IF SY-SUBRC = 0.
    MESSAGE 'Yeni kitap kaydı başarıyla oluşturuldu.' TYPE 'S' .
  ENDIF.
ENDFORM.



FORM YZRKYT .


  ZBE_T_YAZAR-YAZARNO    = P_YZRNO1.
  ZBE_T_YAZAR-YAZARAD    = P_YZRAD.
  ZBE_T_YAZAR-YAZARSOYAD = P_YZRSOY.

  MODIFY ZBE_T_YAZAR.

  IF SY-SUBRC = 0.
    MESSAGE 'Yeni yazar kaydı başarıyla oluşturuldu.' TYPE 'S' .
  ENDIF.
ENDFORM.
